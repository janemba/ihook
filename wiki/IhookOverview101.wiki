#sidebar TableofContents
<wiki:toc max_depth="1" />
= Introduction =

Here is a detailed overview of ihook version 1.0.1 in action. All the example was compiled with mingw32-g++/mingw32-gcc also, Code::Blocks IDE was used.


= Using ihook static library for DLL injection =

In this example two hook type is used :
 # Hook on a Windows API function : _httpOpenRequestA_ from _wininet.dll_ 
 # Hook on a function code : function inside the DLL

The DLL is generated by Code::Blocks and I compiled it with ihook static library. Next, I used *RemoteDLL* tool to inject it inside Internet Explorer process.

=== `main.cpp` ===
{{{
#include <stdio.h>
#include <wininet.h>

#include "main.h"
#define IHOOK_CALL_STDCALL
#include "hookit.h"


typedef HINTERNET (WINAPI *h_OpenReq) (HINTERNET, LPCTSTR, LPCTSTR, LPCTSTR,
                                       LPCTSTR, LPCTSTR, DWORD, DWORD_PTR);
typedef int (*h_not) (const char*);

static void writeToLog(const char *msg)
{
    HANDLE hFile;
    DWORD dwBytesWritten = 0;

    hFile = CreateFile("C:\\test_log.txt",
                       FILE_APPEND_DATA,
                       FILE_SHARE_READ,
                       NULL,
                       OPEN_ALWAYS,
                       FILE_ATTRIBUTE_NORMAL,
                       NULL);

    if (hFile == INVALID_HANDLE_VALUE)
        MessageBoxA(NULL, "CreateFile", "ERROR", MB_OK);
    else {
           WriteFile(hFile, msg, strlen(msg), &dwBytesWritten, NULL);
           WriteFile(hFile, "\n", 1, &dwBytesWritten, NULL);
           CloseHandle(hFile);
    }
}

HINTERNET WINAPI hook_OpenRequest(HINTERNET hConnect,
                                  LPCTSTR verb,
                                  LPCTSTR objectName,
                                  LPCTSTR version,
                                  LPCTSTR referer,
                                  LPCTSTR acceptTypes,
                                  DWORD dwFlags,
                                  DWORD_PTR dwContext)
{
    h_OpenReq   fct;
    DWORD       addr;


    writeToLog((const char*) objectName);

    addr = getReturnAddressByName((char*)"HttpOpenRequestA", (char*)"wininet.dll");
    fct  = (h_OpenReq) addr;

    return (fct(hConnect, verb, objectName, version, referer, acceptTypes, dwFlags, dwContext));
}

static int  nothing(const char *msg)
{
    MessageBoxA(NULL, msg, "I'm in nothing function", MB_OK);
    return (0);
}

static int  hook_nothing(const char *msg)
{
    DWORD addr;
    h_not fct;

    MessageBoxA(NULL, msg, "HOOKED", MB_OK);

    addr = getReturnAddressByAddr((DWORD) &nothing);
    fct  = (h_not) addr;

    return (fct(msg));
}



extern "C" DLL_EXPORT BOOL APIENTRY DllMain(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved)
{
    switch (fdwReason)
    {
        case DLL_PROCESS_ATTACH:
            hookitByAddress((DWORD) &nothing, (DWORD) &hook_nothing); // Also, you can try this hookitByAddress((DWORD) &nothing + 123, (DWORD) &hook_nothing);
            hookitByName((char*)"HttpOpenRequestA", (char*)"wininet.dll", (DWORD) hook_OpenRequest);

            nothing("hook function code");

            break;

        case DLL_PROCESS_DETACH:
            unhookByName((char *) "HttpOpenRequestA", (char*) "wininet.dll");
            unhookByAddress((DWORD) &nothing);
            break;
    }
    return TRUE;
}

}}}
----
=== `main.h` ===
{{{
#ifndef __MAIN_H__
#define __MAIN_H__

#include <windows.h>

/*  To use this exported function of dll, include this header
 *  in your project.
 */

#ifdef BUILD_DLL
    #define DLL_EXPORT __declspec(dllexport)
#else
    #define DLL_EXPORT __declspec(dllimport)
#endif

#endif
}}}
----

=== compilation ===
{{{
mingw32-g++-4.7.2.exe  -O2 -Wall -DBUILD_DLL -DIHOOK_ENGINE_LIB -c main.cpp -o obj\Release\main.o
mingw32-gcc-4.7.2.exe -shared -Wl,--output-def=bin\Release\libihook_test_dll.def -Wl,--out-implib=bin\Release\libihook_test_dll.a -Wl,--dll  obj\Release\main.o   -o bin\Release\ihook_test_dll.dll -s  -luser32 lib\libihook.lib
}}}
----

Next *RemoteDLL* was used to inject the DLL inside *IEXPLORE.exe* process.

[[http://ihook.googlecode.com/svn/wiki/ihook_101_static.png]

{{{
c:\>type test.log.txt
/v6exp3/6.gif
/v6exp3/6.gif
/
/sd/classic.css?release_20130227
/sd/all-minified.js?release_20130227
/sd/html5.js
/js/lib/login.slashdot.org/engage.js
/ga.js
/adj/ostg.slashdot/pg_index_p1_leader;pg=index2;logged_in=0;tile=1;sz=728x90;u=;ord=1696706494391379?
/__utm.gif?utmwv=5.3.9&utms=7&utmn=1068636903&utmhn=slashdot.org&utme=8(User%20Type*Page)9(Anon*index2)&utmcs=utf-8&utmsr=1680x1050&utmvp=903x544&utmsc=32-bit&utmul=en-us&utmje=1&utmfl=6.0%20r79&utmdt=Slashdot%3A%20News%20for%20nerds%2C%20stuff%20that%20matters&utmhid=1143675976&utmr=-&utmp=%2F&utmac=UA-36136016-1&utmcc=__utma%3D57409013.1484006048.1360783922.1362007594.1362088058.8%3B%2B__utmz%3D57409013.1360783922.1.1.utmcsr%3D(direct)%7Cutmccn%3D(direct)%7Cutmcmd%3D(none)%3B&utmu=qRAgAC~
/__utm.gif?utmwv=5.3.9&utms=8&utmn=587154188&utmhn=slashdot.org&utme=8(User%20Type*Page)9(Anon*index2)&utmcs=utf-8&utmsr=1680x1050&utmvp=903x544&utmsc=32-bit&utmul=en-us&utmje=1&utmfl=6.0%20r79&utmdt=Slashdot%3A%20News%20for%20nerds%2C%20stuff%20that%20matters&utmhid=1143675976&utmr=-&utmp=%2F&utmac=UA-32013-5&utmcc=__utma%3D57409013.1484006048.1360783922.1362007594.1362088058.8%3B%2B__utmz%3D57409013.1360783922.1.1.utmcsr%3D(direct)%7Cutmccn%3D(direct)%7Cutmcmd%3D(none)%3B&utmu=qRAgAC~
/manifest/login?version=2013.1_ws_widgets_rc9
/EMEA/campaigns/chrome/v2/chrome_custom_script.js?click=http://www.googleadservices.com/pagead/aclk?sa=L&ai=CosIxjNIvUbTHLoXc0AGS3YDwCL6U-dUCjrymlFf2m6vJlwEQASCMgdoXUKqezfUEYPv5_IKICqABmp3h6APIAQmoAwGqBF1P0HaQ19C3iKcq55OYzgdkYB1DNEXymylZiJceb3fjSQBBwUWdTy_NUw5Z9UyrZHBa2nSrZ-LU0-UVOVl3qavmni9N8FllYd57kMfNYT4mLEplKH5SelJrmasdsVOIBgGgBhGAB87inhc&num=1&cid=5GiLdGCskpzxcrwf2VMAgRp7&sig=AOD64_0BwXJXEgh_CRCFyqTxZDHE9hH_Xw&client=ca-pub-4006818487458500&adurl=;ord=1750070465&adgroupid=2393266358&urlIndex=128
/pagead/images/adchoices/icon.png
/pagead/images/adchoices/en.png
/push?client=ca-pub-4006818487458500
/pagead/js/r20130225/r20110914/abg.js
/pagead/images/adchoices/icon.png
/pagead/images/adchoices/en.png
/push?client=ca-pub-4006818487458500
/adj/ostg.slashdot/sd_hub_icon;tile=2;sz=200x90;ord=1696706494391379?
/2.1.6/providers.css
/2.1.6/providers-ie.css
/viewad/2757253/2675_SlashCloudUpdate_HubIcon_v2.gif
/adj/ostg.slashdot/mainpage_p33_powerswitch;pg=index2;logged_in=0;tile=3;sz=980x66;u=;ord=1696706494391379?
/sd/logo_w_l.png
/sd/classic/img/glyphish-icons-16-w.png
/viewad/817-grey.gif
/sd/topics/bitcoin_64.png
/sd/topics/security_64.png
/sd/firehose/043/680/605-1-thumb.png
/sd/topics/censorship_64.png
/sd/topics/programming_64.png
/sd/topics/os_64.png
/sd/topics/court_64.png
/sd/topics/science_64.png
/sd/topics/games_64.png
/sd/topics/patents_64.png
/sd/topics/bug_64.png
/sd/topics/military_64.png
/sd/topics/australia_64.png
/sd/topics/china_64.png
/sd/topics/internet_64.png
/sd/topics/transportation_64.png
/adj/ostg.slashdot/pg_index_p83_medrec;pg=index2;logged_in=0;tile=4;sz=300x250,300x600;u=;ord=1696706494391379?
/sd/classic/img/twitter_24.png?1
/sd/classic/img/facebook_24.png
/sd/classic/img/gplus_24.png
/sd/classic/img/rss_24.png
/EMEA/campaigns/chrome/v2/chrome_custom_script.js?click=http://www.googleadservices.com/pagead/aclk?sa=L&ai=CYtkVkdIvUe-GGfTa0AGo7oCYB76U-dUC1tGmlFf2m6vJlwEQASCMgdoXUKqezfUEYPv5_IKICqABmp3h6APIAQmoAwGqBGFP0E-CqcBHER99Sth3LVa9xH5IksNFqySB6HQzFAMSIkRp5cRBIWhme1og7kxezfQ1IIb1dKbFfdScRqnKu6WZRuW6jswxAY7G9pFZxQqhm8mCNznidPgF74mmDTw80NSpiAYBoAYRgAfO4p4X&num=1&cid=5Gh8QQL_uZJIq4Y_NXEPfycz&sig=AOD64_3HWoj6zWDXpKa4Vo77HGC4xj6OUg&client=ca-pub-4006818487458500&adurl=;ord=1292413583&adgroupid=2393266358&urlIndex=112
/pagead/images/adchoices/icon.png
/pagead/images/adchoices/en.png
/push?client=ca-pub-4006818487458500
/pagead/js/r20130225/r20110914/abg.js
/pagead/images/adchoices/icon.png
/pagead/images/adchoices/en.png
/?google_gid=CAESEOa4Q5JLJRwBM7vh-0J_wjA&google_cver=1&google_push=
/adj/ostg.slashdot/pg_index_p31_lower_poll_spons;pg=index;logged_in=0;tile=5;ord=1696706494391379?
/adj/ostg.slashdot/pg_index_CPL_medrec;pg=index;logged_in=0;tile=6;sz=300x250;ord=1696706494391379;?
/adj/ostg.slashdot/pg_index_p85_medrec;pg=index2;logged_in=0;tile=7;sz=300x250,300x600;u=;ord=1696706494391379?
/pagead/show_ads.js
/pagead/js/r20130225/r20130206/show_ads_impl.js
/pagead/render_ads.js
/pagead/ads?client=ca-ostg_js&format=300x250_pas_abgnc&output=html&h=250&w=300&lmt=1362088592&channel=SD_Consumer_Electronics&region=default&ad_type=text%2Cimage%2Cflash%2Chtml&adtest=off&ea=0&alt_color=ffffff&color_bg=cccccc&color_border=bababa&color_line=c8c8c8&color_link=002f2f&color_text=000000&oe=utf8&flash=6.0.79.0&url=http%3A%2F%2Fslashdot.org%2F&adsafe=high&dt=1362088591474&shv=r20130225&cbv=r20130206&saldr=1&correlator=1362088592065&frm=20&adk=3033987521&ga_vid=1926927673.1362088592&ga_sid=1362088592&ga_hid=1143675976&ga_fc=0&ga_wpids=UA-32013-5&u_tz=60&u_his=2&u_java=1&u_h=1050&u_w=1680&u_ah=1020&u_aw=1680&u_cd=32&u_nplug=0&u_nmime=0&dff=arial&dfs=13&adx=34&ady=4345&biw=903&bih=527&oid=3&fu=0&ifi=1&dtd=1002
/pagead/osd.js
/sd/dice_logo.png
/simgad/18215602213710758187
/pagead/images/adchoices/icon.png
/pagead/images/adchoices/en.png
/pagead/js/r20130225/r20110914/abg.js
/pagead/images/adchoices/icon.png
/pagead/images/adchoices/en.png
/pagead/images/x_button.png
/pagead/images/x_button_dark.png
/pagead/images/green-check.png
/pagead/images/google-logo.png
/adj/ostg.slashdot/pg_index_google_medrec;pg=index2;logged_in=0;tile=8;sz=300x250,300x600;u=;ord=1696706494391379?
/pagead/show_ads.js
/pagead/js/r20130225/r20130206/show_ads_impl.js
/pagead/render_ads.js
/pagead/ads?client=ca-ostg_js&format=300x250_pas_abgnc&output=html&h=250&w=300&lmt=1362088595&channel=slashdot_imu_geo_us&region=default&ad_type=text%2Cimage%2Cflash%2Chtml&adtest=off&ea=0&alt_color=ffffff&color_bg=cccccc&color_border=bababa&color_line=c8c8c8&color_link=002f2f&color_text=000000&oe=utf8&flash=6.0.79.0&url=http%3A%2F%2Fslashdot.org%2F&adsafe=high&dt=1362088594699&shv=r20130225&cbv=r20130206&saldr=1&prev_fmts=300x250_pas_abgnc&correlator=1362088592065&frm=20&adk=2897144109&ga_vid=1926927673.1362088592&ga_sid=1362088592&ga_hid=1143675976&ga_fc=0&ga_wpids=UA-32013-5&u_tz=60&u_his=2&u_java=1&u_h=1050&u_w=1680&u_ah=1020&u_aw=1680&u_cd=32&u_nplug=0&u_nmime=0&dff=arial&dfs=15&adx=34&ady=6565&biw=903&bih=527&oid=3&fu=0&ifi=2&dtd=611
/b?c1=2&c2=6035546&rn=0.5209887944075158&c7=http%3A%2F%2Fslashdot.org%2F&c3=&c4=&c5=&c6=&c10=&c15=&c16=&c8=Slashdot%20(15)&c9=&cv=1.7
/ad/N5390.150143.9313156834521/B7270132.18;sz=1x1;ord=1213486923?
/simgad/16124474438877531828
/pagead/js/r20130225/r20110914/abg.js
/pagead/images/adchoices/icon.png
/pagead/images/adchoices/en.png
/sd/classic/img/twitter_24.png?1
/sd/classic/img/facebook_24.png
/sd/classic/img/gplus_24.png
/sd/classic/img/rss_24.png
/sd/logo_w_l.png
/sd/logo_w_l.png
/sd/logo_w_l.png
/sd/logo_w_l.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/twitter_24.png?1
/sd/classic/img/facebook_24.png
/sd/classic/img/gplus_24.png
/sd/classic/img/rss_24.png
/sd/logo_w_l.png
/sd/logo_w_l.png
/sd/logo_w_l.png
/sd/logo_w_l.png
/sd/logo_w_l.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/twitter_24.png?1
/sd/classic/img/facebook_24.png
/sd/classic/img/gplus_24.png
/sd/classic/img/rss_24.png
/sd/logo_w_l.png
/sd/classic/img/glyphish-icons-16-w.png
/sd/classic/img/glyphish-icons-16-w.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
/rel/img/c7a91677d94f4a79e1b26c8ceb31af82.png
}}}